<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>3101199</title>
</head>
<body>
<font
 style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"
 face="times new roman,times,serif" size="3">Dear Jian<br>
<br>
Thanks for the acknowledgment.<br>
<br>
Regards<br>
Venkatramanan<br>
<br>
&lt;Jianning Wang&gt; wrote--------------<br>
Hi Venkatramanan,<br>
Thanks for delivering the patch on time.<br>
<br>
Regards,<br>
Jianning Wang<br>
<br>
From:<span class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support<br>
</font><span
 style="color: rgb(0, 0, 0); font-family: Arial,Helvetica,sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; display: inline ! important; float: none;"></span>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">
<div>Dear Jian</div>
<div><br>
</div>
<div>The official patch is available at:<span>&nbsp;</span><a
 href="http://bonitas.zohocorp.com/232530/webnms4/16Jan2013/WebNMS_Framework_5_2_SP-0_10.ppm"
 target="_blank">http://bonitas.zohocorp.com/232530/webnms4/16Jan2013/WebNMS_Framework_5_2_SP-0_10.ppm</a></div>
<div><br>
</div>
<div>Please get back to us for any further clarificiation in this
regard.</div>
<div><br>
</div>
<div>Thanks &amp; regards</div>
<div>Venkatramanan</div>
<div><br>
</div>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Hi Jianning,</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Happy New Year to You !</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">We can find single class
using the executeQueryStmt , in the source which has been given to
Genband as PPM. We will provide the fix for both, the class having
executeQueryStmt and replacing usages of non-transaction connections
with transactions as official patch on or before 16th Jan .</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Please get back to us
for any further clarification.</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Regards,</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">&lt;Jianning Wang&gt;
wrote--------------</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Hi Venkatramanan,</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Happy New Year!</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Does any WebNMS
software, which GENBAND received, use the executeQueryStmt method of
the connection pool?</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">When could we expect to
receive the next official WebNMS patch that contains the WebNMS fixes
for replacing the usagess of the non-transaction connections with
transactions?</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Regards,</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;"><font
 face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div
 style="color: rgb(0, 0, 0); font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: arial,helvetica,sans-serif;">
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Dear
Jian<br>
The OOM issue will come only from the&nbsp;</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">executeQueryStmt
method if the statement is not closed.<br>
There are no such chances of memory leaks from other methods in
connection pool.<br>
</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
April<br>
<br>
To answer your question as what was the improvement,<br>
</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Please
note that when you call ConnectionPool APIs to execute a query, you can
use 2 APIs - either&nbsp;</span><font
 face="times new roman, times, serif" size="3"><a
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQuery%28java.sql.PreparedStatement%29"
 target="_blank">executeQuery(PreparedStatement)</a>&nbsp;OR&nbsp;</font><a
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQueryStmt%28java.lang.String%29"
 target="_blank">executeQueryStmt(Statement)</a></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">In
4.7, For both these implementations, internally a Prepared Statement
was used to execute the query.<br>
<br style="font-family: Times New Roman,Times,serif;">
<span style="font-family: Times New Roman,Times,serif;">But in 5.2, to
execute&nbsp;</span></span><a
 style="font-family: Times New Roman,Times,serif;"
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQueryStmt%28java.lang.String%29"
 target="_blank">executeQueryStmt(Statement)</a><span
 style="font-family: Times New Roman,Times,serif; font-size: medium;">,
a statement itself is used because if this query is a repetitive query
it will be called through&nbsp;</span><a
 style="font-family: Times New Roman,Times,serif;"
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQuery%28java.sql.PreparedStatement%29"
 target="_blank">executeQuery(PreparedStatement)</a><br
 style="font-family: Times New Roman,Times,serif;">
<span
 style="font-family: Times New Roman,Times,serif; font-size: medium;">But
since a statement is used (in spite of the existence of&nbsp;</span><a
 style="font-family: Times New Roman,Times,serif;"
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQuery%28java.sql.PreparedStatement%29"
 target="_blank">executeQuery(PreparedStatement)</a><span
 style="font-family: Times New Roman,Times,serif; font-size: medium;">),
it means that&nbsp;<i><b>this query is not a repetitive query and is
rarely used</b></i>.<br>
Hence spawning a prepared statement which will cached at the driver,
will be an overhead (But a statement is not like that - once it is
closed, there are no traces)</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><span
 style="font-family: Times New Roman,Times,serif;">Only due to the
reason the behaviour was changed. But since it was not explicity
mentioned, it has caused an issue.</span><br
 style="font-family: Times New Roman,Times,serif;">
<br>
We believe this addresses your query. Please get back to us for any
further clarification in this regard.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Dear
April</span></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">&lt;Jianning
Wang&gt; wrote--------------</span><br>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Is the memory
leaking issue only in the executeQueryStmt() method of the WebNMS 5
ConnenctionPool API or the other methods of the WebNMS 5
ConnenctionPool have the same issue?</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: April
Pennisi&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I'm not sure I
understand the benefit you introduced with this behavior change. Does
this change affect event processing in a positive way? &nbsp;Can you
quantify that?</font></div>
<div><font face="times new roman, times, serif" size="3">Thanks,</font></div>
<div><font face="times new roman, times, serif" size="3">April
Pennisi&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">On Dec 14,
2012, at 2:33 AM, "ZohoCorp WebNMS Support" &lt;<a
 href="mailto:nms-support@webnms.com" target="_blank">nms-support@webnms.com</a>&gt;
wrote:</font></div>
</div>
<div
 style="padding: 3px; font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;">
<div style="font-family: arial,helvetica,sans-serif; font-size: 13px;">
<div><font face="times new roman, times, serif" size="3">Jian<br>
<br>
When we analyzed the executeQueryStmt implementations in 4.7 &amp; 5.2,
the main difference was:<br>
<br>
In 4.7, a preparedStatement is fetched for the String and the same is
executed (</font><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">PreparedStatementWrapper
psw = fetchStatement(); stmt = psw.getStatement();
rs=stmt.executeQuery(sqlstr);</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">)</span></div>
<div><font face="times new roman, times, serif" size="3">Since the same
prepared statement is returned for the same statement, it will not be
an increase in memory.<br>
</font><font face="times new roman, times, serif" size="3"><br>
In 5.2, the API used is&nbsp;</font><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;"><b>Connection.createStatement().</b></span><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;"><b>executeQuery(sqlstr);</b></span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">,&nbsp;</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">this
statement will be a new one for every execution and has to be closed
once we execute this statement.</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
This behavior was introduced mainly because ConnectionPool itself has
an&nbsp;<a
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQuery%28java.sql.PreparedStatement%29"
 target="_blank">API to execute preparedStatements</a>&nbsp;and to
prevent the overhead to have the cached prepared statements (the
statements prepared will not be maintained by WebNMS cache and will
only be present in the driver's cache).<br>
<br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">But
it was a mistake that we did not mention about closing the statement.</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">We
will update the document soon.<br>
<br>
For now, please let us know whether the memory leak is resolved by this
change.<br>
<br>
Thanks &amp; regards</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Venkatramanan<br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</span></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Could you
please provide the related Hibernate reference document &nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support<br>
</font>
<div>
<div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Dear Jian</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">We acknowledge that we
should have documented it.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">But OOM due to this was
only a recent discovery. (after the release of 5.0 SP1).</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">We will highlight this
in the document.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Please note that in 5.2,
since the O-R layer is in hibernate, hibernate demands to do this in
the finally block.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">We believe this change
will solve the OOM issues.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">We will include the
transactionfix classes in the next official patch.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Please get back to us if
you face any further issues.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Thanks &amp; regards</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">&lt;Jianning Wang&gt;
wrote--------------</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Hi Venkatramanan,</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Thanks for the quick
response and the suggested workaround.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">We have been using the
same WebNMS API (com.adventnet.management.transaction.ConnectionPool)
since in IEMS with WebNMS 4.7 and there was no need for our codes to
get and close the statement in IEMS.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">I have also checked the
WebNMS 5 developer guide and there is no mention that there is a need
to get and close the statement for WebNMS 5.</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Regards,</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana; font-size: 12px; background-color: rgb(254, 254, 254);"><font
 face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support<br>
<br>
</font></div>
<font face="times new roman, times, serif" size="3"><font>Dear Jian<br>
<br>
Thanks a lot for the test program.<br>
We executed the same and observed that the number of statements shooted
up and OOM came within hours.<br>
<br>
But we observed a major miss in the test program - mainly when we
execute,&nbsp;</font><span style="color: rgb(0, 0, 255);"><a
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQueryStmt%28java.lang.String%29"
 target="_blank">ConnectionPool.getInstance().executeQueryStmt(query);</a></span>,
the statement has to be closed explicitly as follows:<br>
</font>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; rs =
ConnectionPool.getInstance().executeQueryStmt(query);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; if(rs.next())</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count =
rs.getInt(1);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">....</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;} finally {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; try {</b></font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (rs != null)
{</b></font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp;&nbsp;<span style="background-color: rgb(254, 255, 0);">rs.getStatement().close();</span></b></font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</b></font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; } .....</font></div>
<div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; try {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (rs != null)
{</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; rs.close();</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font face="times new roman, times, serif" size="3">We observed
that it is not called in your source.<br>
Once this is done, the number of statements was the same throughout.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
Here are our results.&nbsp;Please check the following files in the
attached zip:</font><br>
<br>
<font face="times new roman, times, serif" size="3">1.&nbsp;<b>NonTransactionQuery.java</b>&nbsp;-
A RunProcessInterface process which can just be configured in WebNMS as
follows and run - It will run the select query 100 times for every 10
seconds in non-transaction mode:</font><br>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><br>
PROCESS test.NonTransactionQuery</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">ARGS NULL</font></div>
<div
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</div>
<font face="times new roman, times, serif" size="3">2.&nbsp;<b>non-txn-count_Jdbc4Statement.txt</b>&nbsp;-
Log of statements when the above code is run&nbsp;</font><b
 style="font-family: 'times new roman',times,serif; font-size: medium;"><u><i>without</i></u></b><font
 face="times new roman, times, serif" size="3">&nbsp;the&nbsp;</font><b
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;"><span
 style="background-color: rgb(254, 255, 0);">rs.getStatement().close()</span></b><font
 face="times new roman, times, serif" size="3">&nbsp;call - They were
continuously increasing.</font><br>
<font face="times new roman, times, serif" size="3"><br>
3.&nbsp;<b>TransactionQuery.java</b>&nbsp;- The same query is executed
in transaction mode.&nbsp;</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">RunProcessInterface
process which can just be configured in WebNMS as follows:</span></div>
<div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">PROCESS test.TransactionQuery</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">ARGS NULL</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><br>
</font></div>
<font face="times new roman, times, serif" size="3">4.&nbsp;</font><font
 face="times new roman, times, serif" size="3"><b>txn-count_Jdbc4Statement.txt</b>&nbsp;-
Log of statements when the above code is run in transaction. -&nbsp;<b><i>Note
that in transaction, they never increase.</i></b><br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">5.&nbsp;<b>changed_non_transaction_Jdbc4Statement.txt</b>&nbsp;-
When the non-transactional code is run&nbsp;<b><u><i>with</i></u></b>&nbsp;</font><font
 face="times new roman, times, serif" size="3">the&nbsp;</font><b
 style="font-size: small; color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace;"><span
 style="background-color: rgb(254, 255, 0);">rs.getStatement().close()</span></b><font
 face="times new roman, times, serif" size="3">&nbsp;call.</font></div>
</div>
</div>
<div
 style="font-family: 'times new roman',times,serif; font-size: medium;">Please
note that the in&nbsp;<b>changed_non_transaction_Jdbc4Statement</b>,
the number of statments never increase.<br>
<br>
From the above test, here are our recommendations:<br>
1. Please ensure that whenever&nbsp;<span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">ConnectionPool.getInstance().executeQueryStmt(query)</span>,
is called, subsequently&nbsp;<b
 style="font-size: small; color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace;"><span
 style="background-color: rgb(254, 255, 0);">rs.getStatement().close()</span></b>&nbsp;is
also called.</div>
<div><font face="times new roman, times, serif" size="3">2. If its a
recursive / repetetive DB operation, please use transaction -&nbsp;<b><i>Note
that this is why we gave the initial transactionDebug.zip fix to push
the critical/repetitive operations in transaction</i>.</b></font></div>
<div><font face="times new roman, times, serif" size="3">3. It is
highly recommended to use&nbsp;<a
 href="http://www.webnms.com/webnms/help/javadocs/consolidated_javadocs/com/adventnet/management/transaction/ConnectionPool.html#executeQuery%28java.sql.PreparedStatement%29"
 target="_blank">ConnectionPool.<b>executeQuery(PreparedStatement)</b></a>&nbsp;compared
to&nbsp;</font><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;"><b>executeQueryStmt(query)</b></span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">.</span></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3">If needed, we can have a
call at&nbsp;<b><i>10.30 AM EST</i></b>. (</font><font
 face="times new roman, times, serif" size="3">8775748061&nbsp;Pass
code:&nbsp;</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium; background-color: rgb(254, 255, 102);"><b><i>65368368#</i></b></span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">)</span></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;">
<div><font face="times new roman, times, serif" size="3">Please get
back to us for any further clarification in this regard.<br>
<br>
Thanks &amp; regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan<br>
</font></div>
<br>
</div>
</div>
<font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
We found that the previous mail has not reached our mail server (not
even marked as spam.)<br>
We will test this code and will definitely update you tomorrow.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan, Have you tried the new test codes on the GVM virtual box?</font></div>
<div><font face="times new roman, times, serif" size="3">Will you be
able to create a similar test for your WebNMS 5 server?</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan, Neither closing the ResultsSet nor logging the sql
statement will have an impact on the leaking of the Jdbc4Statemement
objects. The issue is the WebNMS API
com.adventnet.management.transaction.ConnectionPool. The test model I
sent to ZOHO one month ago is to show the leak and not to show how fast
it leaks. To help ZOHO to investigate the leak, I have created another
test model, which is very simple and can leak more than 100
Jdbc4Statemement objects every 10 seconds (36K/h). I attached the java
and class file to this email. What the new test model does:</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">1. I have
changes the DBCleanupPolicy. When the job is executed, its
executeaction() method only retrieves the event count 100 times from
the DB:</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">public void executeAction(PolicyEvent plcEvt) {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; print("Run the dummy DBCleanup
Policy job", Log.SUMMARY);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; int n=100;</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; print("Query the total event
count " + n + " times.", Log.SUMMARY);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; for (int i=0; i&lt;n; i++){</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
getTotalEventCount();</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">}</span></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">2. The method
getTotalEventCount() will use the WebNMS API to get non-trns
connection, execute the query, and close the ReseltsSet:</font></div>
<div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">private int getTotalEventCount()</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">{</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; String query="select count(ID)
from EVENT";</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; int count = -1;</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; java.sql.ResultSet rs = null;</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; try {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rs =
ConnectionPool.getInstance().executeQueryStmt(query);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
if(rs.next())</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; count = rs.getInt(1);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; } catch (NmsStorageException nse)
{</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
printError("NMS Storage exception", nse);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; } catch (UserTransactionException
ute) {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
printError("User Transaction exception", ute);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; } catch (SQLException se) {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
printError("SQL exception", se);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; } finally {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; if (rs != null) {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rs.close();</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
catch (Exception e) {</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; printError("exception while closing
resultset", e);</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><br>
</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; return count;</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">}</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><br>
</font></div>
<span
 style="font-family: 'times new roman',times,serif; font-size: medium; font-weight: bold;"><span
 style="text-decoration: underline;">How to install the test model</span>:</span></div>
<br>
<div><font face="times new roman, times, serif" size="3">1. Copy the
class file DBCleanupPolicy.class to its class path under the classes
dir:<br>
</font><font color="#0000ff" face="courier new, courier, monospace"
 size="2">cp DBCleanupPolicy.class
/run/opt/corp/gvm/1.0.0/classes/com/nortel/iems/server/policy</font><br>
<font face="times new roman, times, serif" size="3"><br>
2. Restart the gvm<br>
</font>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">echo "aim service-u lock gvm 0 f" | cli<br>
echo "aim service-u unlock gvm 0" | cli</font></div>
<br>
<font face="times new roman, times, serif" size="3">3. Change the
&#8220;Period(sec)&#8221; of the DBCleanupJob to 10 seconds:<br>
</font></div>
<div style="text-align: center;"><font
 face="times new roman, times, serif" size="3"><img
 src="http://nms-support:8080/0.jpg"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Here is the
result from my test that has been run for about 1 hour:<br>
Object leaking speed: 103 objects per 10 seconds<br>
</font>
<div style="text-align: center;"><font
 face="times new roman, times, serif" size="3"><img
 src="http://nms-support:8080/1.jpg"></font><br>
</div>
<font face="times new roman, times, serif" size="3">Memory leak speed:
30 MB/hour</font></div>
<div style="text-align: center;"><font
 face="times new roman, times, serif" size="3"><img
 src="http://nms-support:8080/2.jpg"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div><font face="times new roman, times, serif" size="3">Jian<br>
<br>
If you need a call today, please mail us.<br>
We can discuss in the bridge once I reach my home.<br>
<br>
Regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Jian<br>
<br>
We found a utility&nbsp;<a
 href="http://www.postgresql.org/docs/devel/static/pgstatstatements.html"
 target="_blank">pg_stat_statements</a>&nbsp;which logs all the
statements in postgres.<br>
We tried to enable this in the local setup but we are not able to
achieve this due to the lack of knowledge in the build procedure.<br>
We had herewith given a procedure to enable&nbsp;<a
 href="http://www.postgresql.org/docs/devel/static/pgstatstatements.html"
 target="_blank">pg_stat_statements</a>&nbsp;in postgres.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
We would like to have a call at&nbsp;<b><i>9.30 AM</i></b>&nbsp;in this
regard (if needed a desktop sharing session too) to enable the same in
your environment too.<br>
<br>
We can use the following bridge : No. to dial :&nbsp;<b><i>8775748061</i></b>&nbsp;Pass
code:&nbsp;</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium; background-color: rgb(254, 255, 102);"><b><i>65368368#</i></b></span></div>
<div><font face="times new roman, times, serif" size="3"><br>
This will help us to know the statements being executed in postgres
along with other details like how many times it was executed.</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Please
check the attached&nbsp;<b><i>file.html</i></b>, which has a sample
output of this statement.<br>
<br>
Please let us know your acceptance in this regard.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</span></div>
<div><font size="3"><font face="times new roman, times, serif">Dear Jian<br>
<br>
On Saturday, we started the test (adding a collection job to run after
every 5 min) and checked the no. of Jdbc4Statements today morning:<br>
<br>
Following are our findings:<br>
<br>
1. Roughtly the server has run for around 42 hours or&nbsp;<span
 style="font-weight: bold; font-style: italic;">2520</span>&nbsp;minutes.
This means the collection job has been called around 504 (2520 / 5)
times.<br>
2. When we checked the no. of Jdbc4Statements, we observed that there
were 532 statements&nbsp;<br>
3.&nbsp;<span style="font-weight: bold;">No. of statements were
periodically increasing - there was no drastic increase at all</span></font><font
 style="font-size: 12px;" face="times new roman, times, serif"><br>
<br>
</font></font><span
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"></span>
<div><font face="times new roman, times, serif" size="3">Then we
disabled this job (while the logging of statements is still running) -
After 40 min., we could observer that the no. of Statements were&nbsp;<span
 style="font-weight: bold; text-decoration: underline; font-style: italic;">not</span>&nbsp;increasing.<br>
<br>
Hence we could conclude that when a Collection Job is running, for
every run, a Statement gets opened and we are analyzing the same.<br>
<br>
But here we would also like to mention the following things:<br>
<br>
We decompiled your sources and we found a list of sources where there
are chances that statements &amp; resultsets may be left unclosed.<br>
We had herewith attached our findings as
Unclosed_ResultSet_Statements.html<br>
Please go thorugh the same. We do not claim that they are hazardous.<br>
But since we could not have the sources, we could not make sure whether
always the sql objects will be closed.<br>
<br>
We will update you w.r.t the increasing statements in CollectionJob by
tomorrow.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
</font>
<div><font face="times new roman, times, serif" size="3"><br>
From:<span class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
Please note that the below configuration is not modified by WebNMS.<br>
We had run the server for 2 days and are analyzing the log.<br>
</font><span
 style="font-size: medium; font-family: 'times new roman',times,serif;">We
will update you within 9 AM EST today in this regard.</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">&lt;Jianning
Wang&gt; wrote--------------</span></div>
<div><font face="times new roman, times, serif" size="3"><br>
Hi Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I have found
the following c3p0 configuration on the mchange web site (<a
 href="http://www.mchange.com/projects/c3p0/#statementCacheNumDeferredCloseThreads"
 target="_blank">http://www.mchange.com/projects/c3p0/#statementCacheNumDeferredCloseThreads</a><span
 class="Apple-converted-space">&nbsp;</span>):</font></div>
<div><font face="times new roman, times, serif" size="3"><b>statementCacheNumDeferredCloseThreads</b></font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Default: 0</font></div>
<div><font face="times new roman, times, serif" size="3">If set to a
value greater than 0, the statement cache will track when Connections
are in use, and only destroy Statements when their parent Connections
are not otherwise in use. Although closing of a Statement while the
parent Connection is in use is formally within spec, some databases
and/or JDBC drivers, most notably Oracle, do not handle the case well
and freeze, leading to deadlocks. Setting this parameter to a positive
value should eliminate the issue. This parameter should only be set if
you observe that attempts by c3p0 to close() cached statements freeze
(usually you'll see APPARENT DEADLOCKS in your logs). If set, this
parameter should almost always be set to 1. Basically, if you need more
than one Thread dedicated solely to destroying cached Statements, you
should set maxStatements and/or maxStatementsPerConnection so that you
don't churn through Statements so quickly. [See "Configuring Statement
Pooling"]</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">My question to
you is:</font></div>
<div><font face="times new roman, times, serif" size="3"><b>Does ZOHO
set the statementCacheNumDeferredCloseThreads parameter in WebNMS codes?</b></font></div>
<div><font face="times new roman, times, serif" size="3">I have tried
to set statementCacheNumDeferredCloseThreads &nbsp;to 0 explicitly in
the hibernate.cfg.xml (even its default value is 0), and could not see
any improvement in the Jdbc4Statement leak.&nbsp;</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
If ZOHO explicitly set statementCacheNumDeferredCloseThreads to 1 or
larger in the WebNMS codes, this could be the root cause of the
Jdbc4Statement leak.</span></div>
<div><font face="times new roman, times, serif" size="3">BTW, we do not
have access to our computer next Monday morning because of moving.</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Regards,</span></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">From:
Jianning Wang&nbsp;</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Hi
Venkatramanan,</span></div>
<div><font face="times new roman, times, serif" size="3">That is a very
interesting finding. Let just hope that fixing the log could also fix
the Jdbc4statement leaking.</font></div>
<div><font face="times new roman, times, serif" size="3">There is no
need for a call today.</font></div>
<div><font face="times new roman, times, serif" size="3">I am waiting
for the results of your analysis.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support<br>
<br>
</font></div>
<font style="font-family: verdana; font-size: 12px;"
 face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
Here is our product version we had been using for the test:</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">In addition to this,
hibernate &amp; c3P0 are the bundled versions only - 3.2.6 (hibernate)
&amp; 0.9.1 only.</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3"><br>
</font>
<div><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; Product = WebNMS 5.2</span></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Service Pack Version
=AdventNet_Web_NMS-5.2-SP-0.09</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; os name=Linux</font></div>
<div><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; os architecture=amd64</span></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java version=1.6.0_16</font></div>
<div><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; java vm name=Java HotSpot(TM) 64-Bit Server
VM</span></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java vm information =mixed
mode</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java compiler=null</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
********************************************************</font></div>
<div><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">[07
Dec 2012 15:36:47:800] SYS_ERR: &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;-------RDBMS related information------</span></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database product name =
PostgreSQL</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database product
version=9.1.6</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database driver
name=PostgreSQL Native Driver</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database driver
version=PostgreSQL 9.0 JDBC4 (build 801)</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database user name=postgres</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database
URL=jdbc:postgresql://localhost/newdb</font></div>
<font face="times new roman, times, serif" size="3"><br>
We had done some changes in the virtual machine yesterday for the log4j
issue.<br>
We tested today morning in the virtual machine and found that even
after the collection job, the increase in the no. of statements is very
minimal.<br>
For instance we compared the old statement list with the present one
(both attached as zip) - The difference was very much visible -&nbsp;<b><i>only
30 alive statements at any instance compared to 1000 statements in the
last test.</i></b><br>
We will analyze the changes we had done&nbsp;<br>
Shall we have a call today at 11 AM EST whether the collection job
really happens in the virtual machine?<br>
If we get a confirmation on this, we can check what are all the
modifications that has been done which reduced the statements.<br>
<br>
Regards<br>
Venkatramanan<br>
<br>
&lt;Jianning Wang&gt; wrote--------------</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Hi Venkatramanan,</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Thanks for the update.</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Could you please also
send me the hibernate.cfg.xml file you used for the testing with
postgres db.</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Do you use the same
version of WebNMS , Hibernate, c3p0, and postgres jdbc driver in your
test &nbsp;as GVM uses?</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Here are the software
versions used by GVM:</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div style="font-family: verdana; font-size: 12px;"><br>
</div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">Product
= WebNMS 5.2</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">Service
Pack Version =NONE</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">os
name=Linux</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">os
version=2.6.27-pne</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">os
architecture=i386</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
version=1.6.0_30</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
vendor=Sun Microsystems Inc.</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
specification=Java Platform API Specification</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
specification version=1.6</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
vm name=Java HotSpot(TM) Server VM</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
vm information =mixed mode</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">java
compiler=null</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">********************************************************</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;-------RDBMS related information------</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">database
product name = PostgreSQL</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">database
product version=9.1.2</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">database
driver name=PostgreSQL Native Driver</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">database
driver version=PostgreSQL 9.0 JDBC4 (build 801)</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">database
user name=oamdb</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 color="#0000ff" face="courier new, courier, monospace" size="2">database
URL=jdbc:postgresql://oamdb00:5433/GvmbDB</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">[INFO] Initializing
c3p0-0.9.1 [built 16-January-2007 14:46:42; debug? true; trace: 10]</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">[03 Nov 2012
02:20:40:120] cfg.Environment: Hibernate 3.2.6</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Regards,</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div style="font-family: verdana; font-size: 12px;"><font
 face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div style="font-family: verdana; font-size: 12px;">
<div><font face="times new roman, times, serif" size="3">Dear Team<br>
<br>
Today we analyzed the dump we had been running - 9120 PDs for every 10
min (which meant 15 PD/sec - storing everything in database).<br>
But note that the statements were not increasing - only 1800 in no.<br>
We will update you by tomorrow or by Monday with the postgresql testing
results.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Venkatramanan&gt;
wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Team</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">We will update
you tomorrow with our results.</font></div>
<div><font face="times new roman, times, serif" size="3">We will also
run a server for 12 hours in postgres and will update you with the
results</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">On Wed, Dec 5,
2012 at 10:21 PM, Venkatramanan &lt;<a
 href="mailto:venkatramanan@gmail.com" target="_blank">venkatramanan@gmail.com</a>&gt;
wrote:</font></div>
<div><font face="times new roman, times, serif" size="3">Team</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Please note
that we had been running only the MySQL server extensively (even the
Virtual box was of MySQL DB)</font></div>
<div><font face="times new roman, times, serif" size="3">In the initial
2 days we had been running with the Postgres database (with the same
load in 5.2), we could not see an increase in Jdbc4Statements.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">On Wed, Dec 5,
2012 at 10:15 PM, Venkatramanan &lt;<a
 href="mailto:venkatramanan@gmail.com" target="_blank">venkatramanan@gmail.com</a>&gt;
wrote:</font></div>
<div><font face="times new roman, times, serif" size="3">Team</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">We have been
using 5.2 WebNMS and we save all the data into WebNmsDB - no other
database is used.</font></div>
<div><font face="times new roman, times, serif" size="3">We tried this
with both postgres &amp; MySQL at first.</font></div>
<div><font face="times new roman, times, serif" size="3">Since the
virtual box was with MySQL, we have been running this with MySQL for
long.</font></div>
<div><font face="times new roman, times, serif" size="3">Here we could
not see any increase in no. of statements.</font></div>
<div><font face="times new roman, times, serif" size="3">Even in
Postgres case, we had not seen the statements being increased.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">On Wed, Dec 5,
2012 at 9:58 PM, Jianning Wang &lt;<a
 href="mailto:jianning.wang@genband.com" target="_blank">jianning.wang@genband.com</a>&gt;
wrote:</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Do you save
the polled data into database on your WebNMS 5.2 server?&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Does your
WebNMS 5.2 server use POSTGRES DB?</font></div>
<div><font face="times new roman, times, serif" size="3">Do you measure
the number of the Jdbc4statement objects on your WebNMS 5.2 server?</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:
Venkatramanan [mailto:venkatramanan@gmail.com]&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Team</font></div>
<div><font face="times new roman, times, serif" size="3">Unfortunately,
we are not able to see the file at all.</font></div>
<div><font face="times new roman, times, serif" size="3">Please note
that in the VM server since we will not be able to discover any real
devices, this is another WebNMS 5.2 which discovers the routers,
switches and interfaces in our corporate environment.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Since the
memory shoots up when you call PollAPI, we had got a good amount of
polled data for this server.</font></div>
<div><font face="times new roman, times, serif" size="3">We believe
that due to pollAPI, if there is a lot of leakage in terms of
Statements in GenBand EMS, we should be able to see atleast a sizeable
increase in this setup also.</font></div>
<div><font face="times new roman, times, serif" size="3">Please let us
know whether we can have the call tomorrow or you need a call today
(Actually we have not got any updates right now since we are not able
to analyze the hprof file).</font></div>
<div><font face="times new roman, times, serif" size="3">If you need
any other clarifications in this issues, we will definitely have a call
now.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">On Wed, Dec 5,
2012 at 9:33 PM, Jianning Wang &lt;<a
 href="mailto:jianning.wang@genband.com" target="_blank">jianning.wang@genband.com</a>&gt;
wrote:</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Please collect
the data about the number of the Jdbc4statement objects on that server.</font></div>
<div><font face="times new roman, times, serif" size="3">Is the server,
where you run than 8000 PD every 10 sec, the virtual box we sent to you?</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:
Venkatramanan [mailto:venkatramanan@gmail.com]&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Jian</font></div>
<div><font face="times new roman, times, serif" size="3">Sorry for the
delayed reply.</font></div>
<div><font face="times new roman, times, serif" size="3">Right now I am
not able to access the hprof file in the server .</font></div>
<div><font face="times new roman, times, serif" size="3">But for the
past 12 days, the server's memory is not more than 85 MB.</font></div>
<div><font face="times new roman, times, serif" size="3">This has more
than 8000 PD each with interval 10 sec.</font></div>
<div><font face="times new roman, times, serif" size="3">We will check
the Statements and will update you in another 1 hour.</font></div>
<div><font face="times new roman, times, serif" size="3">Please let us
know whether we can have the call now.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">If not, we
will have the call at 12 noon EST.</font></div>
<div><font face="times new roman, times, serif" size="3">Regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3">On Wed, Dec 5,
2012 at 7:41 PM, Jianning Wang &lt;<a
 href="mailto:jianning.wang@genband.com" target="_blank">jianning.wang@genband.com</a>&gt;
wrote:</font></div>
<div><font face="times new roman, times, serif" size="3">We are ok with
9:30 EST.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:
Venkatramanan [mailto:venkatramanan@gmail.com]&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Steve</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">We have a
problem with our mail server as of now.</font></div>
<div><font face="times new roman, times, serif" size="3">Please confirm
the receipt of this mail (sent from GMail) &amp; reply to this mail.</font></div>
<div><font face="times new roman, times, serif" size="3">We will have
the call at 9.30 AM EST (35 min. from now).</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Thanks &amp;
regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3">Dear Steve<br>
<br>
<div>we had created a bridge as follows:</div>
<div><br>
</div>
<div>Number to dial:&nbsp;<b><i><a
 href="http://www.btconferencing.com/globalaccess/?bid=780&amp;itfn=1&amp;ddi=1&amp;ref=btn/"
 target="_blank">8775748061</a></i></b>&nbsp; |&nbsp;&nbsp;Passcode :<b><i>33483434#</i></b></div>
<div><br>
</div>
<div>Please dial in the same.<br>
We will have the call at 9.30 AM EST.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan</div>
</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3">&lt;Stephen Shelegey&gt;
wrote--------------</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3">Let&#8217;s get together to
discuss the unsuccessful results of the latest test jar and discuss the
way forward.\nWith no change in the memory leak results with this or
the previous test jar it&#8217;s seems the area of code that is being
investigated/changed is incorrect.&nbsp;</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Zoho,
please reply back with the bridge information.</span></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3"><br>
Thanks,</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3">Steve</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3"><br>
</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;"><font
 face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div
 style="font-family: verdana,arial,helvetica,sans-serif; font-size: 11px;">
<div><font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
We will check this out.<br>
Please let us know whether the operations which take long time in your
environment are all ensured in transaction.<br>
</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">This
can be tracked with&nbsp;<a
 href="http://dev.mysql.com/doc/refman/5.0/en/slow-query-log.html"
 target="_blank">log-slow-queries</a>&nbsp;option.</span></div>
<div><font face="times new roman, times, serif" size="3">This will help
us to isolate the issue.<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Thanks &amp;
regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I have tried
transactionDebug.zip on my VB with the GVM collection job. I did not
see any improvement.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Have you found
out the root cause of the &nbsp;Jdbc4Statement object leaking?</font></div>
<div><font face="times new roman, times, serif" size="3">Count of the
Jdbc4Statement objects before applying transactionDebug.zip:&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Count of the
Jdbc4Statement objects before applying transactionDebug.zip:&nbsp;</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2"><br>
</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">root &nbsp; &nbsp; 25614 &nbsp; &nbsp; 1 &nbsp;8 02: 16 ?
&nbsp; &nbsp; &nbsp; &nbsp;00: 59: 00 /usr/java/default/bin/java
-Dflag.classname=com.adventnet.nms.startnms.NmsMainBE -cp
/opt/swd/incoming/transactionDebug.zip:
/run/opt/corp/gvm/1.0.0/classes/NmsServerClasses.jar:
/run/opt/corp/gvm/1.0.0/classes:
/run/opt/corp/gvm/1.0.0/classes/NortelServerClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/am_services.jar:
/run/opt/corp/gvm/1.0.0/classes/am_sdk.jar:
/run/opt/corp/gvm/1.0.0/classes/seclib.jar:
/run/opt/corp/gvm/1.0.0/classes/loglib.jar:
/run/opt/corp/gvm/1.0.0/classes/securityinterfaces.jar:
/run/opt/corp/gvm/1.0.0/classes/ISAuthClientFiles.jar:
/run/opt/corp/gvm/1.0.0/classes/am_logging.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSUMClient.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetUpdateManagerInstaller.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSUMServer.jar:
/run/opt/corp/gvm/1.0.0/classes/securityinterfaces.jar:
/run/opt/corp/gvm/1.0.0/classes/g9ems_if.jar:
/run/opt/corp/gvm/1.0.0/classes/SSPFS.jar:
/run/opt/corp/gvm/1.0.0/classes/OMGNotification.jar:
/run/opt/corp/gvm/1.0.0/classes/jaas.jar:
/run/opt/corp/gvm/1.0.0/classes/HTTPClient.jar:
/run/opt/corp/gvm/1.0.0/classes/CemAdapter.jar:
/run/opt/corp/gvm/1.0.0/classes/cpr-</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">From: &nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
Thanks a lot for the acknowledgment.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Thanks for the
explanations and the test classes.</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
I will perform tests with the debug zip you provided &nbsp;this week.</span></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
Following is our analysis about closing a non-transaction connection
after execution:<br>
<br>
We will first explain the present framework.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
In WebNMS, a connection is requested as follows:<br>
</font></div>
<div><font color="#0000ff" face="courier new, courier, monospace"
 size="2">
<div>ConnectionPool cp = ConnectionPool.getInstance();</div>
<div>Connection con = cp.getConnection();</div>
</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
From the thread (which requests the connection), WebNMS ConnectionPool
will know whether it is in transaction - and if yes, it will return a
transaction connection from hibernate<br>
Hibernate will take care of the connection once the transaction is over.<br>
<br>
When the above call is made from a non-transaction connection (case in
question), WebNMS will do the following:</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
A connection array&nbsp;</font><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;"><b>non_txn_con</b>&nbsp;</span><font
 face="times new roman, times, serif" size="3">(initialized with&nbsp;</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">hibernate.cfg.xml's&nbsp;</span><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">nontransaction.connection&nbsp;</span><font
 face="times new roman, times, serif" size="3">as size) is initialized
with a new connection and then the same is returned. (The connection is
populated in the array as well)</font></div>
<div><font face="times new roman, times, serif" size="3">Similarly new
connections will be created till the connection array is full.<br>
Once the number of non-transaction connections is equal to the no.
specified in&nbsp;</font><span
 style="color: rgb(0, 0, 255); font-family: 'courier new',courier,monospace; font-size: small;">nontransaction.connection</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">,
then these connections will be presented to the API calls (which
requests a connection) in a round robin fashion.<br>
After the query is executed, automatically, the connection will be
returned to the WebNMS connection pool.<br>
<br>
</span></div>
<div><font face="times new roman, times, serif" size="3">Now when a
non-transaction connection has to be closed after each &amp; every
query, then we should take care of the following things:<br>
<br>
1. The connection pool&nbsp;<i><b>should monitor each &amp; every
thread to close the connection after each query</b></i>.<br>
2. Those&nbsp;<i><b>API calls which execute the queries should close
the connection after the execution and should intimate the connection
pool</b></i></font></div>
<div><font face="times new roman, times, serif" size="3"><br>
Please note that this will involve a lot of
code/behaviour/implementation change in WebNMS framework in many places
(including the core framework).<br>
Hence it will not be possible for us to change the implementation of
non-transaction connections as of now.<br>
<br>
Instead we had done one main change in WebNMS APIs - We had&nbsp;<i><b>identified
those queries which can take long time to execute and moved them into
transaction (if not done already) and have got the same as a zip</b></i>.<br>
If you have any such API calls (which can take long intervals due to
huge data),&nbsp;<b><i>please move the block into transaction.</i></b><br>
After this change, please check whether there is any improvement in
memory management.<br>
<br>
We will have a call after these results.<br>
</font>
<div><font face="times new roman, times, serif" size="3">Please get
back to us for any further clarification in this regard.<br>
<br>
Thanks &amp; regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan<br>
</font></div>
</div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I am available
for a call.</font></div>
<div><font face="times new roman, times, serif" size="3">Could you
please share the data you collected?</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">GVMB Design,
Genband</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div>
<div><font face="times new roman, times, serif" size="3">Jian<br>
<br>
We had logged today the Jdbc4Statement objects for around 7 hours.<br>
We would like to have a call today.<br>
Once you see this mail and once you are ready for the call, please mail
us, we will call to your desk.<br>
If needed, we can also have a desktop sharing session.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</span></div>
<div><font face="times new roman, times, serif" size="3">Jian<br>
<br>
Apologies if we were sounding skeptic and if that was disgusting.</font></div>
<div><font face="times new roman, times, serif" size="3">We had not
recorded the statement count periodically but within today, I had been
periodically monitoring the statement count and it was always 1.<br>
We will record it tomorrow and will update you with the file also by
Thursday morning in your time.<br>
We will check how far it rises.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I have send
you the procedure how to collect the count of the Jdbc4staement in my
previur email:</font></div>
<div><font face="times new roman, times, serif" size="3">6.Collect the
count of the jdbc4Statement objects by running the following commend:</font></div>
<div><font face="times new roman, times, serif" size="3">a.Cd to the
bin dir of the jdk</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/&gt;
cd /opt/swd/incoming/1.6.0_30/bin</font></div>
<div><font face="times new roman, times, serif" size="3">b.Find the pid
of the WebNMS process:</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/opt/swd/incoming/1.6.0_30/bin&gt;
&nbsp;ps -ef | grep NmsMainBE | grep -v grep | &nbsp;awk '{print $2}'</font></div>
<div><font face="times new roman, times, serif" size="3">28969</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">c. Run the
following command with the pid found in last step:</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/opt/swd/incoming/1.6.0_30/bin&gt;
while [ 1 ]; do ./jmap -histo:live 28969 | grep Jdbc4Statement | tee -a
count_Jdbc4Statement.txt; sleep 10; done</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Have you
collected the data for the day that your run the test? If yes, please
post you data, and if not , please start collect the date by following
the steps I provided and post the data after few hours of collection.</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><br>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">During the
last call, I got the impression that you are still not convinced that
the leaking of the Jdbc4satement objects is a real issue.</font></div>
<div><font face="times new roman, times, serif" size="3">The following
graph shows the Java heap usage of the WebNMS process from one of our
lab:</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">The speed of
the leaking is about 40 MB/hour, which will make the application run
out of memory in about 10 hours if the max heap size &nbsp;is set to
400 MB.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">The rapid
reductions of the application heap usage shown in the graph about are
the result of the temporary relief I put in place, which can be found
far below in the first email of this email chain.</font></div>
<div><font face="times new roman, times, serif" size="3">What the
temporary relief does is to trigger WebNMS to re-establish the DB
connection. &nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: Stephen
Shelegey&nbsp;</font></div>
<font face="times new roman, times, serif" size="3">
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
From:&nbsp;<a href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div><br>
</div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Steve<br>
<br>
We have been running the server in the&nbsp;<b><i>typhoon-base-unit0</i></b>&nbsp;server
for more than a day with one collection job (we deleted the other two
today morning).<br>
We have been periodically monitoring this process.<br>
<br>
What we had observed so far is that at any given point of time, there
is only one statement for the below command<br>
</font><span
 style="color: rgb(51, 51, 255); font-family: 'courier new',courier,monospace; font-size: small;"><b><br>
/opt/swt/incoming/1.6.0_30/bin/jmap -histo:live 14877 | grep
Jdbc4Statement</b></span><font face="times new roman, times, serif"
 size="3"><br>
<br>
Please let us know whether we are are on the right track.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Stephen
Shelegey&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Any progress?
Have you been able to reproduce the leak on your VB?</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Steve</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: Jianning
Wang&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Just one GVM
collection job is needed. Pleas delete the other two GVM collection job.</font></div>
<div><font face="times new roman, times, serif" size="3">The count of
the Jdbc2Statement should be save in a file for later graph. &nbsp;You
chouls just need few houre to see a clear trend of the increase in the
count of the Jdbc2Statement objects.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div><br>
</div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Team<br>
<br>
We have been running this test for around 3 hours and have added 3
collection jobs.<br>
We are yet to see the rise in statement objects.<br>
We are monitoring it as of now.<br>
We have attached the snapshots of the testing.<br>
Please go through the same and let us know if we are on the right track.<br>
<br>
We will keep you updated.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
Earnest apologies for the delay in reply.<br>
We will analyze this and will definitely update you within next Tuesday.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">I have tested
the your new jar file PollDebug.jar, and did not see any improvement in
the leaking of the Jdbc4Statement objects in the WebNMS 5 API
com.adventnet.management.transaction.ConnectionPool.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Fixing PollMgr
can only cover the codes that use it. There are many codes in WebNMS
and GVM that are using the WebNMS API ConnectionPool &nbsp;for queries
and non-transactional updates. Those usages will continue result the
leak of the Jdbc4Statement objects. &nbsp;It is better to fix the
ConnectionPool &nbsp;API.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Test results
of PollDebug.jar:</font></div>
<div><font face="times new roman, times, serif" size="3">The number of
the Jdbc4Statement objects is plotted in the following graph, where &#8220;A&#8221;
marks the start of GVM with the gvmcollectionjob enabled, &nbsp;&#8220;B&#8221;
marks the disable of the gvmcollectionjob, and &#8220;C&#8221; marks the &#8211;re-enable
of the gvmcollectionjob.</font></div>
<div><font face="times new roman, times, serif" size="3">In a real lab,
the over 10-100K of the the Jdbc4Statement objects are leaked every day.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: Jianning
Wang&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">The server
jars are not signed in GVM:</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/opt/swd/incoming/1.6.0_30/bin&gt;
./jarsigner -verify /run/opt/corp/gvm/1.0.0/classes/NmsServerClasses.jar</font></div>
<div><font face="times new roman, times, serif" size="3">jar is
unsigned. (signatures missing or not parsable)</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jianning<br>
<br>
From our past experience with Nortel IEMS, even the server jars were
signed.<br>
Please check this with the command&nbsp;</font><span
 style="color: rgb(51, 51, 255); font-family: 'courier new',courier,monospace; font-size: small;">jarsigner
-</span><span
 style="color: rgb(51, 51, 255); font-family: 'courier new',courier,monospace; font-size: small;">verify&nbsp;</span><span
 style="color: rgb(51, 51, 255); font-family: 'courier new',courier,monospace; font-size: small;">NMS_HOME/classes/NmsServerClasses.jar&nbsp;</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">&nbsp;,
If this returns an output like&nbsp;</span><span
 style="color: rgb(51, 51, 255); font-family: 'courier new',courier,monospace; font-size: small;">jar
is unsigned</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">,
then the PollDebug.jar need not be signed.</span></div>
<div><font face="times new roman, times, serif" size="3">But if it
returns as&nbsp;</font><span
 style="color: rgb(51, 51, 255); font-family: 'courier new',courier,monospace; font-size: small;">jar
verified</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">,
then this jar also need to be signed.<br>
Hope this clarifies.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</span></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">That is a
server jar file. Why we need to sign an server jar file.</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jianning<br>
<br>
Sorry for the inconvenience.<br>
Please check whether the jar is signed with the same signer as that of
the other jars.<br>
We tested this and then only gave the jar - Please note that we did not
face any startup issues.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I have
downloaded the PollDebug.jar file and updated the classpath to include
it as the first component:&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font color="#3333ff" face="courier new, courier, monospace"
 size="2">root@typhoon-base-unit0: /opt/swd/incoming/1.6.0_30/bin&gt;
ps -ef | grep gvm</font></div>
<div><font color="#3333ff" face="courier new, courier, monospace"
 size="2">root &nbsp; &nbsp; &nbsp;2734 &nbsp; &nbsp; 1 &nbsp;4 14: 10
? &nbsp; &nbsp; &nbsp; &nbsp;00: 00: 15 /usr/java/default/bin/java
-Dflag.classname=com.adventnet.nms.startnms.NmsMainBE -cp
/opt/swd/incoming/PollDebug.jar:
/run/opt/corp/gvm/1.0.0/classes/NmsServerClasses.jar:
/run/opt/corp/gvm/1.0.0/classes:
/run/opt/corp/gvm/1.0.0/classes/NortelServerClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/am_services.jar:
/run/opt/corp/gvm/1.0.0/classes/am_sdk.jar:
/run/opt/corp/gvm/1.0.0/classes/seclib.jar:
/run/opt/corp/gvm/1.0.0/classes/loglib.jar:
/run/opt/corp/gvm/1.0.0/classes/securityinterfaces.jar:
/run/opt/corp/gvm/1.0.0/classes/ISAuthClientFiles.jar:
/run/opt/corp/gvm/1.0.0/classes/am_logging.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSUMClient.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetUpdateManagerInstaller.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSUMServer.jar:
/run/opt/corp/gvm/1.0.0/classes/securityinterfaces.jar:
/run/opt/corp/gvm/1.0.0/classes/g9ems_if.jar:
/run/opt/corp/gvm/1.0.0/classes/SSPFS.jar:
/run/opt/corp/gvm/1.0.0/classes/OMGNotification.jar:
/run/opt/corp/gvm/1.0.0/classes/jaas.jar:
/run/opt/corp/gvm/1.0.0/classes/HTTPClient.jar:
/run/opt/corp/gvm/1.0.0/classes/CemAdapter.jar:
/run/opt/corp/gvm/1.0.0/classes/cpr-utils.jar:
/run/opt/corp/gvm/1.0.0/classes/log4j.jar:
/run/opt/corp/gvm/1.0.0/resources:
/run/opt/corp/gvm/1.0.0/classes/OMIClient.jar:
/run/opt/corp/gvm/1.0.0/classes/axis.jar:
/run/opt/corp/gvm/1.0.0/classes/axis-ant.jar:
/run/opt/corp/gvm/1.0.0/classes/jaxrpc.jar:
/run/opt/corp/gvm/1.0.0/classes/saaj.jar:
/run/opt/corp/gvm/1.0.0/classes/wsdl4j-1.5.1.jar:
/run/opt/corp/gvm/1.0.0/classes/commons-discovery-0.2.jar:
/run/opt/corp/gvm/1.0.0/classes/jsch-0.1.28.jar:
/run/opt/corp/gvm/1.0.0/classes/gvmTool.jar: :
/run/opt/corp/gvm/1.0.0/classes/GenbandCLUIHandler.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandMG9KCorbaClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandMG9KCorbaClasses_70.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandMediationClientClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandSESMCorbaClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandSESMCorbaClasses_70.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandSam21CorbaClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandSam21CorbaClasses_60.jar:
/run/opt/corp/gvm/1.0.0/classes/GenbandServerClasses.jar: :
/run/opt/corp/gvm/1.0.0/classes/CemAdapter.jar:
/run/opt/corp/gvm/1.0.0/classes/CemGui.jar:
/run/opt/corp/gvm/1.0.0/classes/IEMSInventoryIfc.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSnmp.jar:
/run/opt/corp/gvm/1.0.0/classes/SNMPDebugger.jar:
/run/opt/corp/gvm/1.0.0/classes/NBAgent.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSAS.jar:
/run/opt/corp/gvm/1.0.0/classes/jaxp.jar:
/run/opt/corp/gvm/1.0.0/classes/xalan.jar:
/run/opt/corp/gvm/1.0.0/classes/Mail.jar:
/run/opt/corp/gvm/1.0.0/classes/activation.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetNPrevalent.jar:
/run/opt/corp/gvm/1.0.0/classes/bsh-1.2b3.jar:
/run/opt/corp/gvm/1.0.0/classes/debugger.jar:
/run/opt/corp/gvm/1.0.0/classes/ManagementServer.jar: :
/run/opt/corp/gvm/1.0.0/apache/tomcat/common/lib/servlet-api.jar:
/run/opt/corp/gvm/1.0.0/apache/tomcat/bin/bootstrap.jar:
/run/opt/corp/gvm/1.0.0/apache/tomcat/bin/tomcat-juli.jar:
/run/opt/corp/gvm/1.0.0/apache/tomcat/bin/commons-logging-api.jar:
/run/opt/corp/gvm/1.0.0/classes/postgresql_jdbc4.jar:
/run/opt/corp/gvm/1.0.0/classes/p6spy.jar:
/run/opt/corp/gvm/1.0.0/conf:
/run/opt/corp/gvm/1.0.0/classes/log4j.jar: :
/run/opt/corp/gvm/1.0.0/classes/AdventNetTftp.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetCLI.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetCLIClient.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetJta.jar:
/run/opt/corp/gvm/1.0.0/classes/jta.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetSnmpDistributedAPI.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetOPExtn.jar:
/run/opt/corp/gvm/1.0.0/classes/JimiProClasses.jar:
/run/opt/corp/gvm/1.0.0/classes/jfreechart.jar:
/run/opt/corp/gvm/1.0.0/classes/jcommon.jar: : /run/opt/corp/gvm/1.0.0:
/run/opt/corp/gvm/1.0.0/classes/ftp.jar:
/run/opt/corp/gvm/1.0.0/classes/AdventNetUI.jar:
/run/opt/corp/gvm/1.0.0/mindterm/mindterm.jar:
/run/opt/corp/gvm/1.0.0/mindterm/ntext.jar:
/run/opt/corp/gvm/1.0.0/classes/hbnlib/hibernate3.jar:
/run/opt/corp/gvm/1.0.0/classes/hb</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Unfortunately,
the WebNMS server does not start after this update. There is any log in
startServerLog.txt.</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: &nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jianning<br>
<br>
Apologies for the inconveience.<br>
The jar is uploaded at:&nbsp;</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><a
 href="http://bonitas.zohocorp.com/232530/webnms4/22Nov2012/PollDebug.jar"
 target="_blank">http://bonitas.zohocorp.com/232530/webnms4/22Nov2012/PollDebug.jar</a></span></div>
<div>
<div><font face="times new roman, times, serif" size="3">Ensure to sign
the same and then update the classpath.<br>
<br>
Please get back to us for any further clarification in this regard.<br>
<br>
Thanks &amp; regards</font></div>
<div><font face="times new roman, times, serif" size="3">Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Our email
server blocked your attachment PollDebug.jar. &nbsp;You can try to
rename it to PollDebug.txt or put it on your ftp server and let me know
how to download it.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support<br>
</font>
<div>
<div><font face="times new roman, times, serif" size="3">Jian</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
Recently we had changed a behaviour in PollMgr where the data
collection in bulk was executed in transaction.<br>
We had included this fix herewith.<br>
Please let us know whether this has any improvement.<br>
If this does not improve the case, we can try with spy log (for the
collected data table - STATSDATAMM_DD_YYYY) and then we can proceed.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">We fill in the
WenNMS object com.adventnet.nms.poll.CollectedInfo and call the WebNMS
function com.adventnet.nms.poll.PollMgr. saveData(colInfo, false).</font></div>
<div><font face="times new roman, times, serif" size="3">There is no
need for a call unless you have made any progress.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div>
<div><font face="times new roman, times, serif" size="3">Team<br>
<br>
Extremely sorry for the delayed reply.<br>
We could see that the jdbc statements'</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">count</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">&nbsp;keep
on raising.<br>
We learnt that the collection job executes many queries.</span></div>
<div><br>
<font face="times new roman, times, serif" size="3">We would like to
know what queries does the Collection job makes and whether they are in
transaction.</font><br>
<font face="times new roman, times, serif" size="3">Shall we have a
call tomorrow anytime between&nbsp;</font><b
 style="font-family: 'times new roman',times,serif; font-size: medium;"><i>8
AM to 10 AM EST</i></b><font face="times new roman, times, serif"
 size="3">&nbsp;tomorrow (</font><b
 style="font-family: 'times new roman',times,serif; font-size: medium;"><i>15th
Nov.</i></b><font face="times new roman, times, serif" size="3">)
discuss about the issue?</font><br>
<font face="times new roman, times, serif" size="3">We will use the
following bridge to discuss:</font><br>
<font face="times new roman, times, serif" size="3">Number to dial:
8775748061. Bridge Participant Passcode :62232264#</font><br>
<font face="times new roman, times, serif" size="3"><br>
Thanks &amp; regards</font><br>
<font face="times new roman, times, serif" size="3">Venkatramanan</font><br>
<br>
</div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">I did not
receive any update from you since one week.</font></div>
<div><font face="times new roman, times, serif" size="3">Are you still
working on this issue?</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: Jianning
Wang&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Do you have
any update about you investigation on the WebNMS memory leak issue?</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jian<br>
<br>
We are yet to see the issue.<br>
We will definitely update you tomorrow.<br>
Apologies for the delay.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Do you have
any update about your investigation of the memory leak issue?</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Dear
Jian<br>
<br>
Thanks for the detailed steps.<br>
Since CollectedJob is a nortel specific feature, we would not have
reproduced it.<br>
We will setup these tings and will start the test tomorrow.<br>
If we have any issues, we will immediately get back to you.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</span></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Thank you for
calling me and discuss the memory leaking issue.</font></div>
<div><font face="times new roman, times, serif" size="3">Here is the
procedure to observe the growth of the number of the Jdbc4Statement
(you can resize each image for better view):</font></div>
<div><font face="times new roman, times, serif" size="3">1.Start the
virtual box of the GVM which Jiayi has sent to Zoho earlier.</font></div>
<div><font face="times new roman, times, serif" size="3">2.Open the GVM
Web Start Client</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">3.Create a
&nbsp;collection job for the GVM device by:</font></div>
<div><font face="times new roman, times, serif" size="3">a.Click on the
&lt;Administration Tools&gt; node in the tree view on the left and then
right-click the &lt;Jobs&gt; and select &lt;Add Job&gt;</font></div>
<div><font face="times new roman, times, serif" size="3">b.Fill in the
dialog like below and click &lt;Add&gt;</font></div>
<div><font face="times new roman, times, serif" size="3">c. Fill in the
CollectionJob Details Dialog like below:</font></div>
<div><font face="times new roman, times, serif" size="3">d.Click on the
&lt;Add&gt; button in the lower-right corner &nbsp;to add a Template:</font></div>
<div><font face="times new roman, times, serif" size="3">e.In the &#8220;GVM
Perf Templates&#8221; dialog, select the first template starting with &#8220;gvm_&#8221;
and then click &lt;Open&gt;</font></div>
<div><font face="times new roman, times, serif" size="3">f.
&nbsp;Repeat Step d and e above to add the all of the rest of the
templates. There are 8 templates in total.</font></div>
<div><font face="times new roman, times, serif" size="3">g.After all of
the 8 templates are added, click &lt;OK&gt; in the CollectionJob
Details Dialog.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">4.Confirm the
collection job is working by:</font></div>
<div><font face="times new roman, times, serif" size="3">a.Wait for one
hour and then go to the &lt;Performance&gt;&lt;Configured Colletion&gt;
view :</font></div>
<div><font face="times new roman, times, serif" size="3">b.Right-click
the &#8220;applicationHeapSize&#8221; and plot the &#8220;Collected Statistic&#8221; graph</font></div>
<div><font face="times new roman, times, serif" size="3">c. You should
see some data is plotted. You will not see the growth of the heap size
because the leak is too small to see in this test case.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">5.Install the
LINUX version of JDK 1.6.0_30 on the virtual box. &nbsp;I have a tar
file of JDK 1.6.0_30 and have uploaded it to ftp.zohocorp.com</font></div>
<div><font face="times new roman, times, serif" size="3">ftp&gt; cd pub</font></div>
<div><font face="times new roman, times, serif" size="3">250 Directory
successfully changed.</font></div>
<div><font face="times new roman, times, serif" size="3">ftp&gt; cd
genband_gvm</font></div>
<div><font face="times new roman, times, serif" size="3">250 Directory
successfully changed.</font></div>
<div><font face="times new roman, times, serif" size="3">ftp&gt; mput
1.6.0_30.tar</font></div>
<div><font face="times new roman, times, serif" size="3">You can scp it
to the VB and untar it.</font></div>
<div><font face="times new roman, times, serif" size="3">scp -P 2220
1.6.0_30.tar mtc@&lt;IP of the host where the virtual box is
running&gt;:/opt/swd/incoming</font></div>
<div><font face="times new roman, times, serif" size="3">The password
for the &#8220;mtc&#8221; user is &#8220;mtc&#8221; without the quotations.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">6.Collect the
count of the jdbc4Statement objects by running the following commend:</font></div>
<div><font face="times new roman, times, serif" size="3">a.Cd to the
bin dir of the jdk</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/&gt;
cd /opt/swd/incoming/1.6.0_30/bin</font></div>
<div><font face="times new roman, times, serif" size="3">b.Find the pid
of the WebNMS process:</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/opt/swd/incoming/1.6.0_30/bin&gt;
&nbsp;ps -ef | grep NmsMainBE | grep -v grep | &nbsp;awk '{print $2}'</font></div>
<div><font face="times new roman, times, serif" size="3">28969</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">c. Run the
following command with the pid found in last step:</font></div>
<div><font face="times new roman, times, serif" size="3">root@typhoon-base-unit0:/opt/swd/incoming/1.6.0_30/bin&gt;
while [ 1 ]; do ./jmap -histo:live 28969 | grep Jdbc4Statement | tee -a
count_Jdbc4Statement.txt; sleep 10; done</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">61: &nbsp;
&nbsp;320 &nbsp; 38400 &nbsp;org.postgresql.jdbc4.Jdbc4Statement</font></div>
<div><font face="times new roman, times, serif" size="3">62: &nbsp;
&nbsp;308 &nbsp; 36960 &nbsp;org.postgresql.jdbc4.Jdbc4Statement</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">7.Let it run
for few hours or a day and plot the collected count of the
jdbc4Statement objects( in file count_Jdbc4Statement.txt), You can see
a steady increase of the number of the jdbc4Statement objects.</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From:&nbsp;<a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a>&nbsp;[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Stephen<br>
<br>
We will call to this no. today at 9 AM EDT.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Stephen
Shelegey&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div>
<div style="font-family: verdana,arial,helvetica,sans-serif;">
<div>
<div><font face="times new roman, times, serif" size="3">In case you
don&#8217;t have Jianning&#8217;s number it is 1-343-883-2651.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Steve</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: Jianning
Wang&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Could you
please give me a call around &nbsp;9:00 AM EDT on Thursday Oct. 25 to
discuss the memory leak issue?</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">From: Stephen
Shelegey&nbsp;</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3">Thanks for
your support on this. Please treat this ticket with high priority.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Steve</font></div>
<div><font face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div>
<div><font face="times new roman, times, serif" size="3">Jianning<br>
<br>
We have got the hprof file and are analyzing it.<br>
We will update you at the earliest.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">&lt;Jianning
Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">I have
uploaded the gvm_pid_30943.hprof file to ftp.zohocorp.com under
/pub/genband_gvm:</font></div>
<div><font face="times new roman, times, serif" size="3">226 File
receive OK.</font></div>
<div><font face="times new roman, times, serif" size="3">644631613
bytes sent in 7.6e+02 seconds (8.2e+02 Kbytes/s)</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
<div><font face="times new roman, times, serif" size="3">GVMB Design,
Genband</font></div>
<div><font face="times new roman, times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
</div>
<div>
<div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Dear
Jian</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
If this method of upload does not works out, then please follow the
below procedure:</span></div>
<div>
<hr>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 1: Go to the Machine which has got internet access.</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 2: Open the command prompt.</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 3: Type &lt; ftp ftp.zohocorp.com &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 4: Type &lt; anonymous &gt; in the Login Name prompt</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 5: Type &lt; Customers full Mail ID &gt; in the
password prompt</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 6: Type &lt; bin &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 7: Type &lt; hash &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 8: Type &lt; cd pub &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 9: Type &lt; mkdir Airgo(dir name) &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 10: Type &lt; cd newly created dir name &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 11: Type &lt; mput file name &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Step 12: Type &lt; bye &gt;</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i><br>
</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Note: The messages typed within &lt; &gt; are the commands
that has</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>to be executed.</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i><br>
</i></font></div>
<div><font color="#000099" face="'times new roman', times, serif"
 size="3"><i>Please provide us the the Directory name , the file names
you had uploaded so that we would download them from our site.</i></font></div>
<hr></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Thanks
&amp; regards<br>
Venkatramanan<br>
<br>
&lt;Jianning Wang&gt; wrote--------------</span></div>
</div>
<div><font face="'times new roman', times, serif" size="3">Hi
Venkatramanan,</font></div>
<div><font face="'times new roman', times, serif" size="3">I have read
the hibernate/c3p0 documents and tried different configurations.
&nbsp;I attach our configuration file for hibernate and c3p0.</font></div>
<div><font face="'times new roman', times, serif" size="3">I have tried
to upload &nbsp;the gvm_pid_30943.hprof file (650MB) to
ftp.zohocorp.com under /pub/genband_gvm and fialed.</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div><font face="'times new roman', times, serif" size="3">Please
provide a new ftp server for uploading the heap dump.</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div><font face="'times new roman', times, serif" size="3">The leak is
not directly in the WebNMS API objects but in
com.mchange.v2.c3p0.impl.NewPooledCennection. The issue could be caused
by &#8220;uses the certain number of connections from c3P0 for non
transaction by the &nbsp;internal logic&#8221;. It might be not ok to
checkout a connection from the Hibernate connection pool and keep using
it for the whole life of the process.</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div><font face="'times new roman', times, serif" size="3">Regards,</font></div>
<div><font face="'times new roman', times, serif" size="3">Jianning Wang</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div><font face="'times new roman', times, serif" size="3">From:<span
 class="Apple-converted-space">&nbsp;</span><a
 href="mailto:nms-scp@zohocorp.com" target="_blank">nms-scp@zohocorp.com</a><span
 class="Apple-converted-space">&nbsp;</span>[mailto:nms-scp@zohocorp.com]
On Behalf Of ZohoCorp WebNMS Support</font></div>
<div>
<div><font face="times new roman, times, serif" size="3">Dear Jianning<br>
<br>
We would like to clarify the following things:<br>
<br>
</font></div>
<div><font face="times new roman, times, serif" size="3">1. Till date
we have not got any Out-of-memory issues in ConnectionPool w.r.t
transaction / non-transaction connections.</font></div>
<div><font face="times new roman, times, serif" size="3">2. While we
faced scenarios like 3 non-transactional queries taking so long time
that the other non</font><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">-transactional
operations wait for long to execute, we have<u><i><b>not</b></i></u>&nbsp;got
any OOM issues in Connection Pool</span></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">3.
We would like to know more about the term -&nbsp;</span><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><i><b>cache
of the 3 pooled connections&nbsp;</b></i>- Note that the connections do
not have any other memory associated with them. The only size is the
size of the Connection object.<br>
<br>
In addition, please go through the below explanation of connection pool:</span></div>
<div>
<hr>
<div>
<div style="text-align: center;"><font
 face="'times new roman', times, serif" size="3"><big><span
 style="font-weight: bold; text-decoration: underline;">WebNMS
Connection pooling</span></big></font><br>
</div>
<font face="'times new roman', times, serif" size="3">Please find our
analysis and explanation.</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div style="font-weight: bold; text-decoration: underline;"><font
 face="'times new roman', times, serif" size="3">C3P0 Pooling Framework:</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div><font face="'times new roman', times, serif" size="3">In
C3P0,there is no separate pool for transaction connections or non
transaction connections, as we used to have in WebNMS 4 versions.</font></div>
<div><font face="'times new roman', times, serif" size="3">In C3P0
configurations, we have c3p0.min_size, c3p0.max_size etc. which need to
be configured properly</font></div>
<div><font face="'times new roman', times, serif" size="3">c3p0.min_size
specifies the minimum number of connections that needs to be created
for initialization. In our case, these number of connections will be
created during server startup itself, before the startup of NMS
processes.</font></div>
<div><font face="'times new roman', times, serif" size="3">c3p0.max_size
specifies the maximum number of connections that can be created at the
maximum.</font></div>
<div><font face="'times new roman', times, serif" size="3">Once the
number of connections required exceeds the minimum size, the C3P0
expands the pool by configured number of connections until it reaches
the max_size.</font></div>
<div><font face="'times new roman', times, serif" size="3">This
expansion is based on another parameter viz. c3p0.acquire_increment.</font></div>
<div><font face="'times new roman', times, serif" size="3">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;1. Say for example, if that value is 1, in
this case if three threads are waiting for acquiring connection and if
expansion of pool is necessary, the first expansion of pool will give
connection to 1 thread alone and the other 2 threads will wait.&nbsp;</font></div>
<div><font face="'times new roman', times, serif" size="3">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;2. In this case there is very high
possibility for the 2nd and 3rd thread for getting timed out, after
waiting for the configured time(c3p0.checkoutTimeout) before getting
connection.</font></div>
<div><font face="'times new roman', times, serif" size="3">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp;3. If the pool expansions completed before
these threads get timedout, they may get their connections successfully.</font></div>
<div><font face="'times new roman', times, serif" size="3">The ideal
value for c3p0.acquire_increment should be &gt;=c3p0.min_size, so that
the expansion of pools happen in batch.The value for c3p0.min_size can
also be configured as equal as c3p0.max_size,to make it similar to
WebNMS 4.7 versions and to avoid unnecessary expansion of pools, which
improves performance.</font></div>
<div><font face="'times new roman', times, serif" size="3"><br>
</font></div>
<div><font face="'times new roman', times, serif" size="3"><b><u>WebNMS
Pooling</u>:</b></font></div>
<div>
<ol>
  <li><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">In
order to provide compatibility to the WebNMS 4 version customers,
WebNMS provides non transaction connection support also, in addition to
transaction connections.</span></li>
  <li><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">Of
the c3p0.max_size connections, we use the certain number of connections
from c3P0 for non transaction connections by internal logic. This is
again configurable by "nontransaction.connection" in hibernate.cfg.xml</span></li>
  <li><span
 style="font-family: 'times new roman',times,serif; font-size: medium;">So,if
you have specified c3p0.max_size as 35 and nontransaction.connection as
15, in hibernate.cfg.xml, the max number of transaction connections
will be 20.</span></li>
</ol>
</div>
</div>
<div>
<hr></div>
<div><font face="times new roman, times, serif" size="3">We believe
this will help you to properly configure the nontransaction connections.<br>
If the issue persists, please&nbsp;<a
 href="http://bonitas.zohocorp.com/upload/index.jsp?to=nms-support@webnms.com"
 target="_blank">upload</a>&nbsp;the&nbsp;<i><b>.hprof file</b></i>, we
will analyze the same and will update you.<br>
<br>
Thanks &amp; regards<br>
Venkatramanan<br>
<br>
&lt;Jianning Wang&gt; wrote--------------</font></div>
<div><font face="times new roman, times, serif" size="3">Hi,</font></div>
<div><font face="times new roman, times, serif" size="3">We have
encountered the Java OutOfMemory error, which were caused by the WebNMS
5 API com.adventnet.management.transaction.ConnectionPool:</font></div>
<div><span
 style="font-family: 'times new roman',times,serif; font-size: medium;"><br>
The WebNMS API holds 3 Hibernate/c3p0 pooled connection in its fied
non_txn_con[]. I suspect that WebNMS intends to keep the 3 pooled
connection checked out for the life time of the application process.
This will cause the cache of the 3 pooled connections filled up
endlessly until the OutOfMemory error.</span></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">All of our DB
accesses are via the WebNMS 5 ConnectionPool API. I have checked the
Java doc of the WebNMS 5 ConnectionPool API, and cannot find anything
that allow me to cleanup those caches, or check in the old Hibernate
pooled connections and check out new ones.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Closing those
non_txn connections
(ConnectionPool.getInstance().getConnection().close()) does release all
of the leaked memory, but the WebNMS 5 ConnectionPool API does not get
new connections from the Hibernate connection pool to replace the old,
closed connections in its fied non_txn_con[]. This will cause WebNMS to
stop working normally.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">The work
around I current try is to Close the connections. Make WebNMS to think
that it has lost the DB connection</font></div>
<div><font face="times new roman, times, serif" size="3">This will
trigger WebNMS to end its current Hibernate session and to re-connect
to DB.</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; if ( (heapSize*100)/heapMaxSize &gt; 50 ) {</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ConnectionPool pool =
ConnectionPool.getInstance();</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int numCenn= 3;</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Connection non_txn_cnt;</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (int i=0; i&lt;numCenn;
i++) {</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
non_txn_cnt = pool.getConnection();</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
try {</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; non_txn_cnt.close();</font></div>
<div><font face="times new roman, times, serif" size="3">pool.handleConnectionFail(non_txn_cnt,
new</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp;
SQLException("Connection Exception", "08006", 8006));</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
catch (SQLException e) {</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; //e.printStackTrace();</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div>
<div><font face="times new roman, times, serif" size="3">&nbsp; &nbsp;
&nbsp; &nbsp; }</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">This leaking
can be observed on any lab and the difference is only the spead of this
leaking, which depends on how heavy those three non-txn connection are
used by WebNMS and Genband codes.</font></div>
<div><font face="times new roman, times, serif" size="3"><br>
</font></div>
<div><font face="times new roman, times, serif" size="3">Regards,</font></div>
<div><font face="times new roman, times, serif" size="3">Jianning Wang</font></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
